# 威胁匹配触觉反馈系统

## 项目简介

这是一个Python项目，通过UDP服务器接收游戏数据，使用威胁评估算法选择最有威胁的敌人，并通过串口发送触觉震动信号给用户。

## 功能特性

- UDP服务器监听5005端口接收游戏数据
- 威胁评估算法综合考虑距离、角度和敌人类型
- 通过COM7串口发送触觉震动信号
- 完整的错误处理和日志记录

## 项目结构

```
MatchAlgorithm/
├── main.py              # 主程序入口
├── threat_analyzer.py   # 威胁评估算法模块
├── serial_handler.py    # 串口通信模块
├── udp_server.py        # UDP服务器模块
├── models.py            # 数据模型定义
├── requirements.txt     # 依赖包列表
└── README.md           # 项目说明文档
```

## 安装依赖

```bash
pip install -r requirements.txt
```

## 使用方法

1. 确保COM7串口设备已连接
2. 运行主程序：
   ```bash
   python main.py
   ```
3. 程序将在5005端口监听UDP数据
4. 接收到数据后，会自动分析威胁并发送震动信号

## 数据格式

接收的JSON数据格式：

```json
{
  "round": 1,
  "playerPosition": {
    "x": 0.0,
    "y": 0.0,
    "z": 0.0
  },
  "targets": [
    {
      "id": 1,
      "angle": 45.23,
      "distance": 12.50,
      "type": "Tank",
      "position": {"x": 10.5, "y": 0.0, "z": 8.3}
    }
  ]
}
```

## 威胁评估算法

威胁度计算公式：

```
威胁度 = (1 / (距离 + 1)) × (1 / (|角度| + 1)) × 类型因子
```

- 距离因子：距离越近威胁越大
- 角度因子：角度越小（正前方）威胁越大
- 类型因子：Tank = 2.0, Soldier = 1.0

## 震动信号格式

发送到串口的格式：`X Y\n`
- X: 振动器编号（固定为1）
- Y: 震动强度（200或255）
  - 255: 高威胁
  - 200: 低威胁

## 配置说明

- UDP端口：5005（可在`udp_server.py`中修改）
- 串口：COM7（可在`main.py`中修改）
- 波特率：9600（可在`main.py`中修改）
- 振动器编号：1（可在`main.py`中修改）

## 注意事项

- 确保COM7串口设备已正确连接
- 确保5005端口未被占用
- 程序运行时会持续监听，使用Ctrl+C退出

